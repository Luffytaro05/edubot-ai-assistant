<!--(conversations.html):-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversation Logs - EduChat Admin Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='assets/css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>EduChat Admin</h3>
            </div>
            <nav class="sidebar-nav">
    <ul>
        <li class="{% if active_page == 'dashboard' %}active{% endif %}">
            <a href="{{ url_for('dashboard') }}"><i class="fas fa-th-large"></i> Dashboard</a>
        </li>
        
        <li class="section-header">USER MANAGEMENT</li>
        <li class="{% if active_page == 'users' %}active{% endif %}">
            <a href="{{ url_for('users') }}"><i class="fas fa-users"></i> User Accounts</a>
        </li>
        <li class="{% if active_page == 'roles' %}active{% endif %}">
            <a href="{{ url_for('roles') }}"><i class="fas fa-user-shield"></i> Roles & Permissions</a>
        </li>
        
        <li class="section-header">CHATBOT MANAGEMENT</li>
        <li class="{% if active_page == 'conversations' %}active{% endif %}">
            <a href="{{ url_for('conversations') }}"><i class="fas fa-comments"></i> Conversation Logs</a>
        </li>
        <li class="{% if active_page == 'faq' %}active{% endif %}">
            <a href="{{ url_for('faq') }}"><i class="fas fa-question-circle"></i> FAQ Management</a>
        </li>
        <li class="{% if active_page == 'settings' %}active{% endif %}">
            <a href="{{ url_for('settings') }}"><i class="fas fa-cog"></i> Bot Settings</a>
        </li>
        
        <li class="section-header">ANALYTICS</li>
        <li class="{% if active_page == 'usage' %}active{% endif %}">
            <a href="{{ url_for('usage') }}"><i class="fas fa-chart-bar"></i> Usage Statistics</a>
        </li>
        <li class="{% if active_page == 'feedback' %}active{% endif %}">
            <a href="{{ url_for('feedback') }}"><i class="fas fa-heart"></i> User Feedback</a>
        </li>
    </ul>
</nav>

            
            <!-- User Profile at Bottom -->
            <div class="sidebar-user-profile">
                <div class="user-avatar">A</div>
                <div class="user-details">
                    <div class="user-name">Admin User</div>
                    <div class="user-role">Super Administrator</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search conversations" class="search-input" data-search-type="conversations">
                    </div>
                </div>
                <div class="header-right">
                    <div class="notification-icon">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar">A</div>
                        <div class="user-details">
                            <div class="user-name">Admin User</div>
                            <div class="user-role">Super Administrator</div>
                        </div>
                    </div>
                    <div class="logout-icon" onclick="new AuthManager().logout().then(() => window.location.href='/admin/index')">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Conversation Logs</h1>
                        <p class="page-subtitle">Monitor and analyze chatbot conversations</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-outline-primary" onclick="exportConversations()">
                            <i class="fas fa-download"></i>
                            Export
                        </button>
                        <button class="btn btn-primary" onclick="showFilters()">
                            <i class="fas fa-filter"></i>
                            Filters
                        </button>
                    </div>
                </div>

                <!-- Filters Section -->
                <div class="filters-section" id="filters-section" style="display: none;">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Date Range</label>
                                        <select class="form-control" id="date-range">
                                            <option value="today">Today</option>
                                            <option value="week">This Week</option>
                                            <option value="month" selected>This Month</option>
                                            <option value="quarter">This Quarter</option>
                                            <option value="year">This Year</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Office</label>
                                        <select class="form-control" id="office-filter">
                                            <option value="">All Offices</option>
                                            <option value="admissions">Admissions Office</option>
                                            <option value="registrar">Registrar Office</option>
                                            <option value="guidance">Guidance Office</option>
                                            <option value="transportation">Office of Student Affairs</option>
                                            <option value="it">ICT Office</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Sender</label>
                                        <select class="form-control" id="sender-filter">
                                            <option value="">All Senders</option>
                                            <option value="user">User</option>
                                            <option value="bot">Bot</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Status</label>
                                        <select class="form-control" id="status-filter">
                                            <option value="">All Status</option>
                                            <option value="resolved">Resolved</option>
                                            <option value="pending">Pending</option>
                                            <option value="escalated">Escalated</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-actions">
                                <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                                <button class="btn btn-secondary" onclick="clearFilters()">Clear All</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Conversations Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Message</th>
                                <th>Sender</th>
                                <th>Office</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="conversations-table-body">
                            <!-- Conversations will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination-container">
                    <div class="pagination-info">
                        Showing <span id="start-item">1</span> to <span id="end-item">10</span> of <span id="total-items">0</span> conversations
                    </div>
                    <div class="pagination-controls">
                        <button class="btn btn-outline-secondary" onclick="previousPage()" id="prev-btn">
                            <i class="fas fa-chevron-left"></i>
                            Previous
                        </button>
                        <div class="page-numbers">
                            <button class="btn btn-outline-primary active">1</button>
                            <button class="btn btn-outline-secondary">2</button>
                            <button class="btn btn-outline-secondary">3</button>
                        </div>
                        <button class="btn btn-outline-secondary" onclick="nextPage()" id="next-btn">
                            Next
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Conversation Detail Modal -->
    <div class="modal" id="conversation-detail-modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h4>Conversation Detail</h4>
                <button class="btn-close" onclick="closeModal('conversation-detail-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="conversation-detail">
                    <div class="conversation-header">
                        <div class="user-info">
                            <div class="user-avatar">J</div>
                            <div class="user-details">
                                <div class="user-name">John Doe</div>
                                <div class="user-email">john.doe@university.edu</div>
                            </div>
                        </div>
                        <div class="conversation-meta">
                            <span class="office-badge">Admissions Office</span>
                            <span class="status-badge resolved">Resolved</span>
                        </div>
                    </div>
                    <div class="conversation-messages" id="conversation-messages">
                        <!-- Messages will be populated here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('conversation-detail-modal')">Close</button>
                <button class="btn btn-primary" onclick="escalateConversation()">Escalate</button>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='assets/js/core/BaseManager.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/modules/AuthManager.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/modules/ConversationManager.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/utils/toast.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/app.js') }}"></script>

    <script>
        let conversationManager;
let currentPage = 1;
let itemsPerPage = 10;
let currentFilters = {};

document.addEventListener('DOMContentLoaded', function() {
    const authManager = new AuthManager();
    if (!authManager.checkAuth()) {
        window.location.href = '/';
        return;
    }

    conversationManager = new ConversationManager();
    loadConversations();
    setupEventListeners();
});

function setupEventListeners() {
    // Search functionality
    const searchInput = document.querySelector('.search-input');
    searchInput.addEventListener('input', function() {
        const query = this.value.trim();
        if (query) {
            const filteredConversations = conversationManager.searchConversations(query);
            renderConversations(filteredConversations);
        } else {
            loadConversations();
        }
    });

    // Filter change events
    document.getElementById('date-range').addEventListener('change', applyFilters);
    document.getElementById('office-filter').addEventListener('change', applyFilters);
    document.getElementById('sender-filter').addEventListener('change', applyFilters);
    document.getElementById('status-filter').addEventListener('change', applyFilters);
}

// Updated loadConversations function with async/await and fetch
async function loadConversations() {
    try {
        const response = await fetch("http://localhost:5000/api/conversations");
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const conversations = await response.json();
        
        // Enhanced debugging - log first conversation structure
        if (conversations.length > 0) {
            console.log('Sample conversation structure:');
            console.log(JSON.stringify(conversations[0], null, 2));
            console.log('All available keys:', Object.keys(conversations[0]));
        }
        
        renderConversations(conversations);
        updatePagination(conversations.length);
    } catch (error) {
        console.error("Error loading conversations:", error);
        // Show user-friendly error message
        const tbody = document.getElementById('conversations-table-body');
        tbody.innerHTML = '<tr><td colspan="6" class="text-center text-danger">Failed to load conversations. Please try again.</td></tr>';
    }
}

function renderConversations(conversations) {
    const tbody = document.getElementById('conversations-table-body');
    tbody.innerHTML = '';

    conversations.forEach(conversation => {
        console.log('Rendering conversation:', conversation);

        const row = document.createElement('tr');

        // Get the sender field - this is the key change
        const sender = conversation.sender || 'unknown';
        const senderDisplay = sender.toLowerCase() === 'user' ? 'User' : sender.toLowerCase() === 'bot' ? 'Bot' : 'Unknown';
        
        // Get the message content
        const message = conversation.message || '';
        
        // Truncate long messages for table display
        const truncatedMessage = message.length > 100 ? message.substring(0, 100) + '...' : message;

        // DEBUG: Log the data to see what we're working with
        console.log('Sender:', sender);
        console.log('Message:', message);
        console.log('Available fields:', Object.keys(conversation));

        row.innerHTML = `
            <!-- User Column -->
            <td>
                <div class="user-info-cell">
                    <div class="user-avatar">${(conversation.user || 'Guest').charAt(0).toUpperCase()}</div>
                    <div class="user-details">
                        <div class="user-name">${conversation.user || 'Guest'}</div>
                        <div class="user-email">${conversation.email || ''}</div>
                    </div>
                </div>
            </td>

            <!-- Message Column -->
            <td>
                <div class="message-preview" style="max-width: 400px; white-space: pre-wrap; overflow: hidden; text-overflow: ellipsis; max-height: 100px;">
                    ${truncatedMessage}
                </div>
                ${message.length > 100 ? '<small class="text-muted">Click view for full message</small>' : ''}
            </td>

            <!-- Sender Column - NEW -->
            <td>
                <span class="sender-badge sender-${sender.toLowerCase()}">
                    <i class="fas ${sender.toLowerCase() === 'user' ? 'fa-user' : sender.toLowerCase() === 'bot' ? 'fa-robot' : 'fa-question'}"></i>
                    ${senderDisplay}
                </span>
            </td>

            <!-- Office Column -->
            <td>
                <span class="office-badge">${conversation.office || conversation.department || conversation.category || 'General'}</span>
            </td>

            <!-- Date Column -->
            <td>
                <div class="date-info">
                    <div class="date">${formatDate(conversation.date || conversation.timestamp || conversation.created_at)}</div>
                    <div class="time">${formatTime(conversation.date || conversation.timestamp || conversation.created_at)}</div>
                </div>
            </td>

            <!-- Actions Column -->
            <td>
                <div class="action-buttons">
                    <button class="btn btn-sm btn-outline-primary" onclick="viewConversation('${conversation._id || conversation.id}')" title="View Full Conversation">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-warning" onclick="escalateConversation('${conversation._id || conversation.id}')" title="Escalate">
                        <i class="fas fa-flag"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteConversation('${conversation._id || conversation.id}')" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });

    // If no conversations found
    if (conversations.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No conversations found</td></tr>';
    }
}

// Helper functions for date formatting
function formatDate(dateString) {
    if (!dateString) return '';
    try {
        return new Date(dateString).toLocaleDateString();
    } catch (e) {
        return '';
    }
}

function formatTime(dateString) {
    if (!dateString) return '';
    try {
        return new Date(dateString).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    } catch (e) {
        return '';
    }
}

// New deleteConversation function
async function deleteConversation(id) {
    if (!confirm("Are you sure you want to delete this conversation?")) return;
    
    try {
        const response = await fetch(`http://localhost:5000/api/conversations/${id}`, { 
            method: "DELETE" 
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        toast.success('Conversation deleted successfully');
        loadConversations(); // Reload the conversations
    } catch (error) {
        console.error("Error deleting conversation:", error);
        toast.error('Failed to delete conversation');
    }
}

function showFilters() {
    const filtersSection = document.getElementById('filters-section');
    filtersSection.style.display = filtersSection.style.display === 'none' ? 'block' : 'none';
}

function applyFilters() {
    const dateRange = document.getElementById('date-range').value;
    const office = document.getElementById('office-filter').value;
    const sender = document.getElementById('sender-filter').value;
    const status = document.getElementById('status-filter').value;

    currentFilters = { dateRange, office, sender, status };
    
    const filteredConversations = conversationManager.getFilteredConversations(currentFilters);
    renderConversations(filteredConversations);
    updatePagination(filteredConversations.length);
}

function clearFilters() {
    document.getElementById('date-range').value = 'month';
    document.getElementById('office-filter').value = '';
    document.getElementById('sender-filter').value = '';
    document.getElementById('status-filter').value = '';
    
    currentFilters = {};
    loadConversations();
}

function viewConversation(id) {
    const conversation = conversationManager.getById(id);
    if (!conversation) {
        toast.error('Conversation not found');
        return;
    }

    // Get message content and sender info
    const message = conversation.message || '';
    const sender = conversation.sender || 'unknown';
    const senderDisplay = sender.toLowerCase() === 'user' ? 'User' : sender.toLowerCase() === 'bot' ? 'Bot' : 'Unknown';

    // Populate conversation detail modal
    const modal = document.getElementById('conversation-detail-modal');
    const messagesContainer = document.getElementById('conversation-messages');
    
    // Update user info
    modal.querySelector('.user-name').textContent = conversation.user || 'Guest';
    modal.querySelector('.user-email').textContent = conversation.email || '';
    modal.querySelector('.user-avatar').textContent = (conversation.user || 'G').charAt(0).toUpperCase();
    
    // Update office and status badges
    modal.querySelector('.office-badge').textContent = conversation.office || conversation.department || conversation.category || 'General';
    modal.querySelector('.status-badge').textContent = conversation.status || 'Active';
    modal.querySelector('.status-badge').className = `status-badge ${(conversation.status || 'active').toLowerCase()}`;

    // Render conversation message with sender info
    messagesContainer.innerHTML = `
        <div class="message ${sender.toLowerCase() === 'user' ? 'user-message' : 'bot-message'}">
            <div class="message-content">
                <div class="message-sender">
                    <span class="sender-badge sender-${sender.toLowerCase()}">
                        <i class="fas ${sender.toLowerCase() === 'user' ? 'fa-user' : sender.toLowerCase() === 'bot' ? 'fa-robot' : 'fa-question'}"></i>
                        ${senderDisplay}
                    </span>
                </div>
                <div class="message-text" style="white-space: pre-wrap;">${message}</div>
                <div class="message-time">${new Date(conversation.date || conversation.timestamp || conversation.created_at || Date.now()).toLocaleString()}</div>
            </div>
        </div>
    `;

    modal.style.display = 'flex';
}

function escalateConversation(id) {
    if (confirm('Are you sure you want to escalate this conversation?')) {
        const result = conversationManager.escalateConversation(id);
        if (result.success) {
            toast.success('Conversation escalated successfully');
            loadConversations();
        } else {
            toast.error(result.message);
        }
    }
}

function exportConversations() {
    const conversations = conversationManager.getAll();
    const csvContent = conversationManager.exportToCSV(conversations);
    
    if (csvContent) {
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `conversations_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        window.URL.revokeObjectURL(url);
        toast.success('Conversations exported successfully');
    } else {
        toast.error('Failed to export conversations');
    }
}

function updatePagination(totalItems) {
    const startItem = (currentPage - 1) * itemsPerPage + 1;
    const endItem = Math.min(currentPage * itemsPerPage, totalItems);
    
    document.getElementById('start-item').textContent = startItem;
    document.getElementById('end-item').textContent = endItem;
    document.getElementById('total-items').textContent = totalItems;
    
    // Update button states
    document.getElementById('prev-btn').disabled = currentPage === 1;
    document.getElementById('next-btn').disabled = endItem >= totalItems;
}

function previousPage() {
    if (currentPage > 1) {
        currentPage--;
        loadConversations();
    }
}

function nextPage() {
    const totalItems = conversationManager.getAll().length;
    const maxPage = Math.ceil(totalItems / itemsPerPage);
    
    if (currentPage < maxPage) {
        currentPage++;
        loadConversations();
    }
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function logout() {
    const authManager = new AuthManager();
    authManager.logout();
    window.location.href = '../index.html';
}

// Load conversations when page loads (in addition to DOMContentLoaded)
window.onload = loadConversations;

// Global functions
window.showFilters = showFilters;
window.applyFilters = applyFilters;
window.clearFilters = clearFilters;
window.viewConversation = viewConversation;
window.escalateConversation = escalateConversation;
window.deleteConversation = deleteConversation;
window.exportConversations = exportConversations;
window.previousPage = previousPage;
window.nextPage = nextPage;
window.closeModal = closeModal;
window.logout = logout;
    </script>

    <style>
        .sidebar-user-profile {
            position: absolute;
            bottom: 1.5rem;
            left: 1.5rem;
            right: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
        }

        .sidebar-user-profile .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .sidebar-user-profile .user-details {
            flex: 1;
        }

        .sidebar-user-profile .user-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
            margin: 0;
        }

        .sidebar-user-profile .user-role {
            font-size: 0.75rem;
            color: #93c5fd;
            margin: 0;
        }

        .header .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header .user-details {
            display: flex;
            flex-direction: column;
        }

        .header .user-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1e293b;
            margin: 0;
        }

        .header .user-role {
            font-size: 0.75rem;
            color: #64748b;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
        }

        .filters-section {
            margin-bottom: 2rem;
        }

        .filter-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.75rem;
        }

        .user-info-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-info-cell .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .user-info-cell .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-info-cell .user-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1e293b;
            margin: 0;
        }

        .user-info-cell .user-email {
            font-size: 0.75rem;
            color: #64748b;
            margin: 0;
        }

        .message-preview {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Sender Badge Styles - NEW */
        .sender-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .sender-badge.sender-user {
            background: #dcfce7;
            color: #166534;
        }

        .sender-badge.sender-bot {
            background: #dbeafe;
            color: #1e40af;
        }

        .sender-badge.sender-unknown {
            background: #f3f4f6;
            color: #374151;
        }

        .date-info {
            display: flex;
            flex-direction: column;
        }

        .date-info .date {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1e293b;
        }

        .date-info .time {
            font-size: 0.75rem;
            color: #64748b;
        }

        .office-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            background: #e0f2fe;
            color: #0277bd;
            white-space: nowrap;
        }

        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding: 1rem 0;
        }

        .pagination-info {
            font-size: 0.875rem;
            color: #64748b;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .page-numbers {
            display: flex;
            gap: 0.25rem;
        }

        .page-numbers .btn {
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .conversation-detail {
            max-height: 500px;
            overflow-y: auto;
        }

        .conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .conversation-header .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .conversation-header .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
        }

        .conversation-header .user-details {
            display: flex;
            flex-direction: column;
        }

        .conversation-header .user-name {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .conversation-header .user-email {
            font-size: 0.875rem;
            color: #64748b;
            margin: 0;
        }

        .conversation-meta {
            display: flex;
            gap: 0.5rem;
        }

        .conversation-messages {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .message.user-message .message-content {
            background: #dcfce7;
            border-left: 4px solid #16a34a;
        }

        .message.bot-message .message-content {
            background: #dbeafe;
            border-left: 4px solid #2563eb;
        }

        .message-content {
            padding: 1rem;
            border-radius: 8px;
            position: relative;
        }

        .message-sender {
            margin-bottom: 0.5rem;
        }

        .message-text {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .action-buttons {
            display: flex;
            gap: 0.25rem;
        }

        @media (max-width: 768px) {
            .header-actions {
                flex-direction: column;
            }

            .pagination-container {
                flex-direction: column;
                gap: 1rem;
            }

            .conversation-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .message-content {
                max-width: 95%;
            }

            .table-container {
                overflow-x: auto;
            }

            .message-preview {
                max-width: 200px;
            }
        }
    </style>
</body>
</html>
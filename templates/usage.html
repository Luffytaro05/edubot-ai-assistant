<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usage Statistics - EduChat Admin Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="../assets/css/style.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='assets/css/style.css') }}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>EduChat Admin</h3>
            </div>
            <nav class="sidebar-nav">
    <ul>
        <li class="{% if active_page == 'dashboard' %}active{% endif %}">
            <a href="{{ url_for('dashboard') }}"><i class="fas fa-th-large"></i> Dashboard</a>
        </li>
        
        <li class="section-header">USER MANAGEMENT</li>
        <li class="{% if active_page == 'users' %}active{% endif %}">
            <a href="{{ url_for('users') }}"><i class="fas fa-users"></i> User Accounts</a>
        </li>
        <li class="{% if active_page == 'roles' %}active{% endif %}">
            <a href="{{ url_for('roles') }}"><i class="fas fa-user-shield"></i> Roles & Permissions</a>
        </li>
        
        <li class="section-header">CHATBOT MANAGEMENT</li>
        <li class="{% if active_page == 'conversations' %}active{% endif %}">
            <a href="{{ url_for('conversations') }}"><i class="fas fa-comments"></i> Conversation Logs</a>
        </li>
        <li class="{% if active_page == 'faq' %}active{% endif %}">
            <a href="{{ url_for('faq') }}"><i class="fas fa-question-circle"></i> FAQ Management</a>
        </li>
        <li class="{% if active_page == 'settings' %}active{% endif %}">
            <a href="{{ url_for('settings') }}"><i class="fas fa-cog"></i> Bot Settings</a>
        </li>
        
        <li class="section-header">ANALYTICS</li>
        <li class="{% if active_page == 'usage' %}active{% endif %}">
            <a href="{{ url_for('usage') }}"><i class="fas fa-chart-bar"></i> Usage Statistics</a>
        </li>
        <li class="{% if active_page == 'feedback' %}active{% endif %}">
            <a href="{{ url_for('feedback') }}"><i class="fas fa-heart"></i> User Feedback</a>
        </li>
    </ul>
</nav>

            
            <!-- User Profile at Bottom -->
            <div class="sidebar-user-profile">
                <div class="user-avatar">S</div>
                <div class="user-details">
                    <div class="user-name">Super Admin</div>
                    <div class="user-role">Super Administrator</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search statistics" class="search-input" data-search-type="usage">
                    </div>
                </div>
                <div class="header-right">
                    <div class="notification-icon">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" style="display: none;">0</span>
                    </div>
                    
                    <!-- Notification Dropdown Panel -->
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <h3><i class="fas fa-bell"></i> Notifications</h3>
                            <div class="notification-header-actions">
                                <button id="notificationRefreshBtn" title="Refresh notifications">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button id="notificationMarkAllReadBtn" title="Mark all as read">
                                    <i class="fas fa-check-double"></i>
                                </button>
                            </div>
                        </div>
                        <div class="notification-list" id="notificationList">
                            <div class="notification-empty">
                                <i class="fas fa-bell-slash"></i>
                                <p>Loading notifications...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="user-info-dropdown">
                        <div class="user-info" onclick="toggleUserDropdown()">
                            <div class="user-avatar">S</div>
                            <div class="user-details">
                                <div class="user-name">Super Admin</div>
                                <div class="user-role">Super Administrator</div>
                            </div>
                            <i class="fas fa-chevron-down dropdown-arrow"></i>
                        </div>
                        <div class="user-dropdown-menu" id="userDropdownMenu">
                            <a href="javascript:void(0);" onclick="openChangePasswordModal()" class="dropdown-item">
                                <i class="fas fa-key"></i> Change Password
                            </a>
                            <a href="javascript:void(0);" onclick="logout()" class="dropdown-item">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Usage Statistics</h1>
                        <p class="page-subtitle">Monitor chatbot performance and user engagement</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-outline-primary" onclick="exportData()">
                            <i class="fas fa-download"></i>
                            Export Data
                        </button>
                    </div>
                </div>

                <!-- Period Selector -->
                <div class="period-selector">
                    <div class="period-buttons">
                        <button class="btn btn-outline-primary active" data-period="daily">Daily</button>
                        <button class="btn btn-outline-primary" data-period="weekly">Weekly</button>
                        <button class="btn btn-outline-primary" data-period="monthly">Monthly</button>
                    </div>
                    <div class="date-range">
                        <input type="date" id="start-date" class="form-control">
                        <span>to</span>
                        <input type="date" id="end-date" class="form-control">
                        <button class="btn btn-primary" onclick="applyDateRange()">Apply</button>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div class="loading-spinner text-center" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Loading statistics...</p>
                </div>

                <!-- KPI Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon total">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-conversations">0</h3>
                            <p>Total Conversations</p>
                            <span class="stat-change positive">+12.5%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon users">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="unique-users">0</h3>
                            <p>Unique Users</p>
                            <!-- NOTE: Synchronized with Dashboard's Total Users count via /api/dashboard/kpis -->
                            <span class="stat-change positive">+8.3%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon satisfaction">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="avg-satisfaction">0.0</h3>
                            <p>Avg. Satisfaction</p>
                            <span class="stat-change positive">+2.1%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon resolution">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="resolution-rate">0%</h3>
                            <p>Resolution Rate</p>
                            <span class="stat-change positive">+5.7%</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3>Conversation Trends</h3>
                                    <div class="chart-actions" style="display: flex; align-items: center; gap: 0.75rem;">
                                        <div class="date-filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                                            <label for="trend-date-filter" style="margin: 0; font-size: 0.875rem; color: #64748b;">Filter by Date:</label>
                                            <input type="date" id="trend-date-filter" class="form-control form-control-sm" style="max-width: 160px;">
                                            <button class="btn btn-sm btn-outline-primary" onclick="applyTrendDateFilter()" title="Apply Date Filter">
                                                <i class="fas fa-filter"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-secondary" onclick="clearTrendDateFilter()" title="Clear Filter">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="downloadChart('trends')">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="chart-body">
                                    <canvas id="trendsChart" height="300"></canvas>
                                </div>
                            </div>                        </div>
                    </div>
                </div>

                <!-- Department Stats -->
                <div class="department-stats">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Office Performance</h3>
                            <div class="chart-actions" style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
                                <div class="date-filter-group" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <label for="office-date-filter" style="margin: 0; font-size: 0.875rem; color: #64748b;">Filter by Date:</label>
                                    <input type="date" id="office-date-filter" class="form-control form-control-sm" style="max-width: 160px;">
                                    <button class="btn btn-sm btn-outline-primary" onclick="applyOfficeDateFilter()" title="Apply Date Filter">
                                        <i class="fas fa-filter"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="clearOfficeDateFilter()" title="Clear Filter">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <select id="chart-type-selector" class="form-select form-select-sm me-2" onchange="changeChartType()">
                                    <option value="bar">Bar Chart</option>
                                    <option value="pie">Pie Chart</option>
                                    <option value="doughnut">Doughnut Chart</option>
                                    <option value="line">Line Chart</option>
                                    <option value="polarArea">Polar Area</option>
                                </select>
                                <button class="btn btn-sm btn-outline-secondary" onclick="downloadChart('departments')" title="Download Chart Image">
                                    <i class="fas fa-image"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="exportOfficePerformanceCSV()" title="Download CSV Data">
                                    <i class="fas fa-file-csv"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="departmentsChart" height="250"></canvas>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Change Password Modal -->
            <div id="changePasswordModal" class="modal-overlay">
                <div class="modal-container">
                    <div class="modal-header">
                        <h3><i class="fas fa-key"></i> Change Password</h3>
                        <button class="close-modal-btn" onclick="closeChangePasswordModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="changePasswordForm">
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <div class="password-input-group">
                                    <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password" required>
                                    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('currentPassword')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <div class="password-input-group">
                                    <input type="password" id="newPassword" class="form-control" placeholder="Enter new password" required>
                                    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('newPassword')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <small class="form-text">Password must be at least 8 characters long</small>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirm New Password</label>
                                <div class="password-input-group">
                                    <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm new password" required>
                                    <button type="button" class="toggle-password" onclick="togglePasswordVisibility('confirmPassword')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="closeChangePasswordModal()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Change Password</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='assets/js/modules/AuthManager.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/modules/UsageStatsManager.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/modules/NotificationManager.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/utils/toast.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/app.js') }}"></script>
    <script>
        // Declare authManager globally so it's accessible in logout function
        let authManager;
        let usageStatsManager;
        let notificationManager;
        let trendsChart, departmentsChart;
        let currentPeriod = 'daily';

        document.addEventListener('DOMContentLoaded', async function() {
            authManager = new AuthManager();
            if (!authManager.checkAuth()) {
                window.location.href = '/admin/index';
                return;
            }

            // Initialize notification manager
            notificationManager = new NotificationManager();
            await notificationManager.initialize();

            usageStatsManager = new UsageStatsManager();
            initializeCharts();
            await usageStatsManager.initialize();
            setupEventListeners();
            
            // Setup change password form handler
            setupChangePasswordForm();
        });

        function initializeCharts() {
            // Trends Chart
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            window.trendsChart = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Conversations',
                        data: [],
                        borderColor: '#1976d2',
                        backgroundColor: 'rgba(25, 118, 210, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });


            // Departments Chart - Initialize with default bar chart
            const departmentsCtx = document.getElementById('departmentsChart').getContext('2d');
            window.departmentsChart = createDepartmentsChart(departmentsCtx, 'bar', { labels: [], data: [] });
        }

        function loadStats() {
            if (usageStatsManager) {
                usageStatsManager.loadAllStats();
            }
        }

        async function updateKPICards(stats) {
            // Fetch unique users from dashboard KPI endpoint to ensure consistency
            try {
                const dashboardKPIResponse = await fetch('/api/dashboard/kpis');
                if (dashboardKPIResponse.ok) {
                    const dashboardKPI = await dashboardKPIResponse.json();
                    document.getElementById('unique-users').textContent = dashboardKPI.uniqueUsers || 0;
                } else {
                    // Fallback to stats data if dashboard KPI is unavailable
                    document.getElementById('unique-users').textContent = stats.uniqueUsers || 0;
                }
            } catch (error) {
                console.error('Error fetching dashboard KPI for unique users:', error);
                // Fallback to stats data
                document.getElementById('unique-users').textContent = stats.uniqueUsers || 0;
            }
            
            document.getElementById('total-conversations').textContent = stats.totalConversations || 0;
            document.getElementById('avg-satisfaction').textContent = (stats.avgSatisfaction || 0).toFixed(1);
            document.getElementById('resolution-rate').textContent = (stats.resolutionRate || 0) + '%';
        }

        function updateCharts(stats) {
            // Update Trends Chart
            const trendsData = usageStatsManager.getUsageByTimeData(currentPeriod);
            trendsChart.data.labels = trendsData.labels;
            trendsChart.data.datasets[0].data = trendsData.data;
            trendsChart.update();

            // Update Departments Chart
            updateDepartmentsChart();
        }

        function updateDepartmentsChart() {
            const departmentsData = usageStatsManager.getDepartmentStats();
            const chartType = document.getElementById('chart-type-selector').value;
            
            // Destroy existing chart if it exists
            if (window.departmentsChart) {
                window.departmentsChart.destroy();
            }
            
            // Create new chart with selected type
            const departmentsCtx = document.getElementById('departmentsChart').getContext('2d');
            window.departmentsChart = createDepartmentsChart(departmentsCtx, chartType, departmentsData);
        }

        function changeChartType() {
            updateDepartmentsChart();
        }

        function createDepartmentsChart(ctx, chartType, data) {
            const baseConfig = {
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Conversations',
                        data: data.data,
                        backgroundColor: getChartColors(data.labels.length),
                        borderColor: getChartColors(data.labels.length),
                        borderWidth: chartType === 'line' ? 2 : 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: chartType === 'pie' || chartType === 'doughnut' || chartType === 'polarArea'
                        }
                    },
                    scales: chartType !== 'pie' && chartType !== 'doughnut' && chartType !== 'polarArea' ? {
                        y: {
                            beginAtZero: true
                        }
                    } : {}
                }
            };

            return new Chart(ctx, {
                type: chartType,
                ...baseConfig
            });
        }

        function getChartColors(count) {
            const colors = [
                '#1976d2', '#388e3c', '#f57c00', '#7b1fa2', '#d32f2f',
                '#1976d2', '#388e3c', '#f57c00', '#7b1fa2', '#d32f2f'
            ];
            return colors.slice(0, count);
        }


        function formatDuration(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}m ${remainingSeconds}s`;
        }

        function setupEventListeners() {
            // Period selector
            document.querySelectorAll('.period-buttons .btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-buttons .btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.dataset.period;
                    updateCharts();
                });
            });

            // Date range
            const today = new Date();
            const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            document.getElementById('start-date').value = lastWeek.toISOString().split('T')[0];
            document.getElementById('end-date').value = today.toISOString().split('T')[0];

            // Table filter removed - no longer needed
        }

        function updateCharts() {
            if (usageStatsManager) {
                usageStatsManager.loadAllStats();
            }
        }

        function applyDateRange() {
            if (usageStatsManager) {
                usageStatsManager.applyDateRange();
            }
        }

        // Single-date filter functions for Conversation Trends
        function applyTrendDateFilter() {
            const dateInput = document.getElementById('trend-date-filter');
            if (dateInput && dateInput.value && usageStatsManager) {
                usageStatsManager.setTrendDateFilter(dateInput.value);
                toast.success('Date filter applied to Conversation Trends');
            } else {
                toast.error('Please select a date');
            }
        }

        function clearTrendDateFilter() {
            const dateInput = document.getElementById('trend-date-filter');
            if (dateInput) {
                dateInput.value = '';
            }
            if (usageStatsManager) {
                usageStatsManager.clearTrendDateFilter();
                toast.info('Date filter cleared');
            }
        }

        // Single-date filter functions for Office Performance
        function applyOfficeDateFilter() {
            const dateInput = document.getElementById('office-date-filter');
            if (dateInput && dateInput.value && usageStatsManager) {
                usageStatsManager.setOfficeDateFilter(dateInput.value);
                toast.success('Date filter applied to Office Performance');
            } else {
                toast.error('Please select a date');
            }
        }

        function clearOfficeDateFilter() {
            const dateInput = document.getElementById('office-date-filter');
            if (dateInput) {
                dateInput.value = '';
            }
            if (usageStatsManager) {
                usageStatsManager.clearOfficeDateFilter();
                toast.info('Date filter cleared');
            }
        }

        // Filter function removed - no longer needed since we show overall stats only

        function downloadChart(chartType) {
            // Check if data is still loading
            const loadingSpinner = document.querySelector('.loading-spinner');
            if (loadingSpinner && loadingSpinner.style.display !== 'none') {
                toast.error('Please wait for data to finish loading.');
                return;
            }

            // Check if UsageStatsManager is initialized
            if (!usageStatsManager) {
                toast.error('Statistics manager not initialized. Please refresh the page.');
                return;
            }

            let chart;
            let filename;
            
            switch(chartType) {
                case 'trends':
                    chart = trendsChart;
                    filename = 'conversation_trends.png';
                    break;
                case 'departments':
                    chart = window.departmentsChart;
                    if (!chart) {
                        toast.error('Chart not available. Please wait for data to load.');
                        return;
                    }
                    // Check if chart has data
                    if (!chart.data || !chart.data.labels || chart.data.labels.length === 0) {
                        toast.error('No data available to download. Please wait for data to load.');
                        return;
                    }
                    // Generate filename based on current chart type and period
                    const currentPeriod = document.querySelector('.period-buttons .btn.active')?.dataset.period || 'daily';
                    const chartTypeSelector = document.getElementById('chart-type-selector');
                    const selectedChartType = chartTypeSelector ? chartTypeSelector.value : 'bar';
                    const currentDate = new Date().toISOString().split('T')[0];
                    filename = `office_performance_${selectedChartType}_${currentPeriod}_${currentDate}.png`;
                    break;
                default:
                    toast.error('Unknown chart type');
                    return;
            }

            try {
                const link = document.createElement('a');
                link.download = filename;
                link.href = chart.toBase64Image('image/png', 1.0);
                link.click();
                
                toast.success('Chart downloaded successfully');
            } catch (error) {
                console.error('Chart download error:', error);
                toast.error('Failed to download chart');
            }
        }

        function exportData() {
            try {
                const csv = usageStatsManager.exportToCSV();
                downloadCSV(csv, 'usage_statistics.csv');
                toast.success('Data exported successfully');
            } catch (error) {
                toast.error('Failed to export data');
            }
        }

        function exportOfficePerformanceCSV() {
            try {
                // Check if UsageStatsManager is initialized
                if (!usageStatsManager) {
                    toast.error('Statistics manager not initialized. Please refresh the page.');
                    return;
                }

                // Check if data is still loading
                const loadingSpinner = document.querySelector('.loading-spinner');
                if (loadingSpinner && loadingSpinner.style.display !== 'none') {
                    toast.error('Please wait for data to finish loading.');
                    return;
                }

                // Get office performance data
                const departmentsData = usageStatsManager.getDepartmentStats();
                const currentPeriod = document.querySelector('.period-buttons .btn.active').dataset.period;
                
                // Check if data is available
                if (!departmentsData || !departmentsData.labels || departmentsData.labels.length === 0) {
                    toast.error('No office performance data available. Please wait for data to load.');
                    return;
                }
                
                // Create CSV content
                let csv = 'Office Performance Statistics\n';
                csv += `Period: ${currentPeriod}\n`;
                csv += `Generated: ${new Date().toLocaleString()}\n\n`;
                csv += 'Office,Conversations,Users,Avg Duration (sec),Satisfaction,Resolution Rate (%)\n';
                
                // Add data rows
                if (departmentsData && departmentsData.labels && departmentsData.data) {
                    for (let i = 0; i < departmentsData.labels.length; i++) {
                        const office = departmentsData.labels[i];
                        const conversations = departmentsData.data[i];
                        
                        // Get additional stats for this office if available
                        const officeStats = usageStatsManager.getOfficePerformanceDetails();
                        const stats = officeStats[office] || {};
                        
                        csv += `"${office}",${conversations},${stats.users || 0},${stats.avgDuration || 0},${stats.satisfaction || 0},${stats.resolutionRate || 0}\n`;
                    }
                }
                
                // Download CSV
                downloadCSV(csv, `office_performance_${currentPeriod}_${new Date().toISOString().split('T')[0]}.csv`);
                toast.success('Office Performance data exported successfully');
            } catch (error) {
                console.error('Export error:', error);
                toast.error('Failed to export Office Performance data');
            }
        }


        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Toggle user dropdown menu
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdownMenu');
            const dropdownContainer = document.querySelector('.user-info-dropdown');
            
            dropdown.classList.toggle('show');
            dropdownContainer.classList.toggle('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.querySelector('.user-info-dropdown');
            const dropdownMenu = document.getElementById('userDropdownMenu');
            
            if (dropdown && !dropdown.contains(event.target)) {
                dropdownMenu.classList.remove('show');
                dropdown.classList.remove('active');
            }
        });

        // Change Password Modal Functions
        function openChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'flex';
            document.getElementById('changePasswordForm').reset();
            document.getElementById('userDropdownMenu').classList.remove('show');
            document.querySelector('.user-info-dropdown').classList.remove('active');
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'none';
            document.getElementById('changePasswordForm').reset();
        }

        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function setupChangePasswordForm() {
            const changePasswordForm = document.getElementById('changePasswordForm');
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const currentPassword = document.getElementById('currentPassword').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    if (newPassword.length < 8) {
                        showToast('Password must be at least 8 characters long', 'error');
                        return;
                    }
                    
                    if (newPassword !== confirmPassword) {
                        showToast('New passwords do not match', 'error');
                        return;
                    }
                    
                    if (currentPassword === newPassword) {
                        showToast('New password must be different from current password', 'error');
                        return;
                    }
                    
                    try {
                        // Get the auth token
                        const token = authManager.getToken();
                        if (!token) {
                            showToast('Please login again', 'error');
                            return;
                        }

                        const response = await fetch('/api/auth/change-password', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                currentPassword: currentPassword,
                                newPassword: newPassword
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            showToast('Password changed successfully!', 'success');
                            closeChangePasswordModal();
                        } else {
                            showToast(data.message || 'Failed to change password', 'error');
                        }
                    } catch (error) {
                        console.error('Error changing password:', error);
                        showToast('An error occurred while changing password', 'error');
                    }
                });
            }
        }

        window.addEventListener('click', function(event) {
            const modal = document.getElementById('changePasswordModal');
            if (event.target === modal) {
                closeChangePasswordModal();
            }
        });

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'info'} alert-dismissible fade show`;
            toast.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 5000);
        }

        async function logout() {
    // Show confirmation dialog
    const confirmLogout = confirm('Are you sure you want to logout?');
    
    if (confirmLogout) {
        try {
            showToast('Logging out...', 'info');
            await authManager.logout();
            window.location.href = '/admin/index';
        } catch (error) {
            console.error('Logout error:', error);
            showToast('Error during logout', 'error');
            // Still redirect to login page even if logout fails
            window.location.href = '/admin/index';
        }
    }
    // If user clicks "Cancel", do nothing and stay on the page
}

// Alternative logout function with custom modal (more styled)
async function logoutWithModal() {
    // Create custom modal
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'logoutModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Logout</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to logout?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-danger" id="confirmLogoutBtn">Yes, Logout</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Show modal
    const bootstrapModal = new bootstrap.Modal(modal);
    bootstrapModal.show();
    
    // Handle logout confirmation
    document.getElementById('confirmLogoutBtn').addEventListener('click', async function() {
        bootstrapModal.hide();
        try {
            showToast('Logging out...', 'info');
            await authManager.logout();
            window.location.href = '/admin/index';
        } catch (error) {
            console.error('Logout error:', error);
            showToast('Error during logout', 'error');
            window.location.href = '/admin/index';
        }
    });
    
    // Clean up modal after it's hidden
    modal.addEventListener('hidden.bs.modal', function() {
        document.body.removeChild(modal);
    });
}

        // Mobile menu toggle
        function toggleMobileMenu() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            
            sidebar.classList.toggle('active');
            
            if (!overlay) {
                const newOverlay = document.createElement('div');
                newOverlay.className = 'sidebar-overlay';
                newOverlay.onclick = toggleMobileMenu;
                document.body.appendChild(newOverlay);
                setTimeout(() => newOverlay.classList.add('active'), 10);
            } else {
                overlay.classList.toggle('active');
                if (!overlay.classList.contains('active')) {
                    setTimeout(() => overlay.remove(), 300);
                }
            }
        }

        // Global functions
        window.toggleMobileMenu = toggleMobileMenu;
        window.updateCharts = updateCharts;
        window.downloadChart = downloadChart;
        window.exportData = exportData;
        window.exportOfficePerformanceCSV = exportOfficePerformanceCSV;
        window.logout = logout;
    </script>

    <style>
        /* Enhanced Search Styles */
        .search-bar {
            position: relative;
        }
        
        .search-input {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            background: white;
            font-size: 0.875rem;
            min-width: 400px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            min-width: 450px;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .search-bar i {
            position: absolute;
            left: 1rem;
            color: #64748b;
            z-index: 1;
        }
        
        /* Change Password Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-container {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-header h3 i {
            color: #3b82f6;
        }

        .close-modal-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #64748b;
            cursor: pointer;
            padding: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .close-modal-btn:hover {
            background-color: #f1f5f9;
            color: #1e293b;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #1e293b;
            font-size: 0.875rem;
        }

        .password-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-input-group .form-control {
            flex: 1;
            padding-right: 3rem;
        }

        .form-control {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .toggle-password {
            position: absolute;
            right: 0.75rem;
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .toggle-password:hover {
            color: #1e293b;
        }

        .form-text {
            display: block;
            margin-top: 0.375rem;
            font-size: 0.75rem;
            color: #64748b;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-secondary {
            background-color: #f1f5f9;
            color: #475569;
        }

        .btn-secondary:hover {
            background-color: #e2e8f0;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        .header .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .header .user-info:hover {
            background-color: #f1f5f9;
        }

        .header .user-details {
            display: flex;
            flex-direction: column;
        }

        .header .user-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1e293b;
            margin: 0;
        }

        .header .user-role {
            font-size: 0.75rem;
            color: #64748b;
            margin: 0;
        }

        .user-info-dropdown {
            position: relative;
        }

        .dropdown-arrow {
            font-size: 0.75rem;
            color: #64748b;
            transition: transform 0.3s;
        }

        .user-info-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .user-dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .user-dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown-menu .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #1e293b;
            text-decoration: none;
            transition: background-color 0.2s;
            font-size: 0.875rem;
        }

        .user-dropdown-menu .dropdown-item:hover {
            background-color: #f1f5f9;
        }

        .user-dropdown-menu .dropdown-item i {
            font-size: 0.875rem;
            width: 16px;
            text-align: center;
            color: #64748b;
        }

        .period-selector {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .period-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .date-range {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .date-range input {
            width: 150px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.total {
            background: #e3f2fd;
            color: #1976d2;
        }

        .stat-icon.users {
            background: #e8f5e8;
            color: #28a745;
        }

        .stat-icon.satisfaction {
            background: #fff3cd;
            color: #ffc107;
        }

        .stat-icon.resolution {
            background: #fce4ec;
            color: #e91e63;
        }

        .stat-content h3 {
            margin: 0;
            font-size: 2rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .stat-content p {
            margin: 0.25rem 0;
            color: #6c757d;
            font-size: 0.875rem;
        }

        .stat-change {
            font-size: 0.75rem;
            font-weight: 500;
        }

        .stat-change.positive {
            color: #28a745;
        }

        .stat-change.negative {
            color: #dc3545;
        }

        .charts-section {
            margin-bottom: 1.5rem;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .chart-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chart-header h3 {
            margin: 0;
            color: #2c3e50;
            font-weight: 600;
        }

        .chart-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .chart-actions .form-select {
            min-width: 140px;
            font-size: 0.875rem;
        }

        .chart-actions .form-select:focus {
            border-color: #1976d2;
            box-shadow: 0 0 0 0.2rem rgba(25, 118, 210, 0.25);
        }

        .chart-actions .btn {
            min-width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-actions .btn i {
            font-size: 0.875rem;
        }

        .chart-actions .btn[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
        }

        .chart-actions .btn[title] {
            position: relative;
        }

        .chart-body {
            padding: 1.5rem;
        }

        .department-stats {
            margin-bottom: 1.5rem;
        }

        .stats-table-section {
            margin-bottom: 1.5rem;
        }

        .table-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .table-actions select {
            width: 200px;
        }

        .table-container {
            padding: 1.5rem;
        }

        .trend-indicator {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .trend-indicator.positive {
            color: #28a745;
        }

        .trend-indicator.negative {
            color: #dc3545;
        }

        .office-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .stars-rating {
            display: inline-flex;
            gap: 2px;
        }

        .stars-rating i {
            font-size: 0.875rem;
        }

        .loading-spinner {
            padding: 2rem;
            margin: 2rem 0;
        }

        .progress {
            background-color: #e9ecef;
            border-radius: 6px;
        }

        .progress-bar {
            background-color: #28a745;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Mobile Menu Toggle Button */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #1e293b;
            cursor: pointer;
            padding: 0.5rem;
            margin-right: 1rem;
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        
        .mobile-menu-toggle:hover {
            background-color: #f1f5f9;
        }
        
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .sidebar-overlay.active {
            opacity: 1;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 1024px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .sidebar-overlay {
                display: block;
            }
            
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 1000;
                transition: transform 0.3s ease;
                height: 100vh;
                overflow-y: auto;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .period-selector {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
                padding: 1rem;
            }
            
            .period-buttons {
                justify-content: center;
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .period-buttons .btn {
                flex: 1;
                min-width: 90px;
                font-size: 0.875rem;
            }
            
            .date-range {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }
            
            .date-range span {
                display: none;
            }
            
            .date-range input {
                width: 100%;
            }
            
            .date-range .btn {
                width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-icon {
                width: 48px;
                height: 48px;
                font-size: 1.25rem;
            }
            
            .stat-content h3 {
                font-size: 1.5rem;
            }
            
            .stat-content p {
                font-size: 0.8rem;
            }
            
            .stat-change {
                font-size: 0.75rem;
            }
            
            .table-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .table-actions select {
                width: 100%;
            }
            
            .header .user-info .user-details {
                display: none;
            }
            
            .search-bar {
                width: 100%;
            }
            
            .search-input {
                width: 100% !important;
                min-width: 100% !important;
            }
            
            .search-input:focus {
                min-width: 100% !important;
            }
            
            .page-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .header-actions {
                width: 100%;
            }
            
            .header-actions .btn {
                width: 100%;
            }
            
            .page-content {
                padding: 1rem;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
            
            .page-subtitle {
                font-size: 0.875rem;
            }
            
            .chart-card {
                margin-bottom: 1rem;
            }
            
            .chart-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .chart-header h3 {
                font-size: 1.1rem;
            }
            
            .chart-actions {
                width: 100%;
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .chart-actions .form-select {
                width: 100%;
                margin-bottom: 0.5rem;
                font-size: 0.875rem;
            }
            
            .chart-actions .btn {
                flex: 1;
                min-width: 60px;
            }
            
            .chart-body {
                padding: 1rem;
            }
            
            canvas {
                max-height: 250px !important;
            }
            
            .loading-spinner {
                padding: 1.5rem;
            }
            
            .header {
                padding: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .period-selector {
                padding: 0.75rem;
            }
            
            .period-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .period-buttons .btn {
                width: 100%;
                font-size: 0.8rem;
                padding: 0.6rem;
            }
            
            .modal-container {
                width: 95%;
            }
            
            .chart-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .chart-actions .form-select,
            .chart-actions .btn {
                width: 100%;
                margin: 0;
            }
            
            .chart-actions .btn {
                font-size: 0.8rem;
                padding: 0.5rem;
            }
            
            .stat-card {
                padding: 0.875rem;
            }
            
            .stat-icon {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .stat-content h3 {
                font-size: 1.25rem;
            }
            
            .stat-content p {
                font-size: 0.75rem;
            }
            
            .stat-change {
                font-size: 0.7rem;
            }
            
            .chart-header {
                padding: 0.75rem;
            }
            
            .chart-header h3 {
                font-size: 1rem;
            }
            
            .chart-body {
                padding: 0.75rem;
            }
            
            canvas {
                max-height: 200px !important;
            }
            
            .header {
                padding: 0.75rem;
            }
            
            .header-left .mobile-menu-toggle {
                margin-right: 0.5rem;
                font-size: 1.25rem;
            }
            
            .table th {
                font-size: 0.75rem;
                padding: 0.75rem 0.4rem;
            }
            
            .table td {
                font-size: 0.8rem;
                padding: 0.75rem 0.4rem;
            }
            
            .pagination-info {
                font-size: 0.8rem;
                text-align: center;
            }
            
            .period-buttons .btn {
                font-size: 0.75rem;
                padding: 0.5rem;
            }
            
            .date-range input {
                font-size: 0.875rem;
            }
            
            .date-range .btn {
                font-size: 0.8rem;
                padding: 0.6rem;
            }
            
            .chart-header {
                padding: 0.75rem;
            }
        }
    </style>
</body>
</html>
